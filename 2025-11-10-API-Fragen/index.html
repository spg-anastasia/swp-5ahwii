<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trivia Client</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <h1>Trivia Fragen</h1>

    <form id="queryForm">
        <label>Difficulty:
            <select id="difficulty">
                <option value="easy">easy</option>
                <option value="medium">medium</option>
                <option value="hard">hard</option>
            </select>
        </label>

        <label>Category:
            <input id="category" placeholder="Sports" />
        </label>

        <label>Amount:
            <input id="amount" type="number" value="1" min="1" max="50" />
        </label>

        <button type="submit">Laden</button>
    </form>

    <div id="output"></div>

<script>
const form = document.getElementById("queryForm");
const output = document.getElementById("output");

form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const difficulty = document.getElementById("difficulty").value;
    const category = document.getElementById("category").value;
    const amount = document.getElementById("amount").value;

    output.innerHTML = "<p>Loading...</p>";

    try {
        const res = await fetch(`http://localhost:5000/questions?difficulty=${difficulty}&category=${category}&amount=${amount}`);
        const data = await res.json();

        if (!Array.isArray(data)) {
            output.innerHTML = `<p>Fehler: ${data.error || "Unbekannt"}</p>`;
            return;
        }

        renderQuestions(data);
    } catch (err) {
        output.innerHTML = `<p>Fehler: ${err}</p>`;
    }
});

function shuffle(arr) {
    return arr.sort(() => Math.random() - 0.5);
}

function renderQuestions(questions) {
    output.innerHTML = "";

    questions.forEach((q, idx) => {
        const block = document.createElement("div");
        block.className = "question-block";

        const answers = shuffle([q.correct_answer.answer, ...q.incorrect_answers.map(a => a.answer)]);

        block.innerHTML = `
            <h2>Frage ${idx + 1}</h2>
            <p>${q.question}</p>
            <div class="answers">
                ${answers.map(a => `<button class='answer-btn' data-correct='${a === q.correct_answer.answer}'>${a}</button>`).join("")}
            </div>
        `;

        output.appendChild(block);
    });

    document.querySelectorAll(".answer-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            const correct = btn.dataset.correct === "true";
            btn.classList.add(correct ? "correct" : "wrong");
        });
    });
}
</script>
</body>
</html>
